import { CONFIG, getCalculatedConfig } from './config.js';
import { writeFile, generateUniqueString, getTimestamp } from './file-utils.js';
import { mkdir } from 'fs/promises';

/**
 * Constants file generator
 * Responsible for generating individual constant files
 */

/**
 * Generate individual constant files
 * @param {string} outputDir - Directory where to write the constant files
 */
export async function generateConstantFiles(outputDir) {
    const calculated = getCalculatedConfig();
    const constantsDir = `${outputDir}/constants`;
    
    console.log(`üìä Generating ${CONFIG.NUMBER_OF_CHUNKS} individual constant files, each ~${calculated.kbPerConstant}KB`);
    console.log(`üìÅ Creating constants directory: ${constantsDir}`);
    
    // Create constants directory
    await mkdir(constantsDir, { recursive: true });
    
    for (let i = 1; i <= CONFIG.NUMBER_OF_CHUNKS; i++) {
        const constantName = `CONSTANT_${String(i).padStart(3, '0')}`;
        const constantValue = generateUniqueString(i, calculated.charsPerConstant);
        const fileName = `constant-${String(i).padStart(3, '0')}.ts`;
        const filePath = `${constantsDir}/${fileName}`;
        
        const content = `// Generated constant - ${constantName}
// Generated by: ${CONFIG.GENERATED_BY} v${CONFIG.VERSION}
// Generated on: ${getTimestamp()}

export const ${constantName} = '${constantValue}';
`;
        
        writeFile(filePath, content, `constant file ${String(i).padStart(3, '0')}`);
    }
}
